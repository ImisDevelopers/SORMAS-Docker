{"remainingRequest":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/src/components/LocationFormGroup.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/src/components/LocationFormGroup.vue","mtime":1589906836721},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/css-loader/dist/cjs.js","mtime":1584795993125},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1584795993380},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/postcss-loader/src/index.js","mtime":1584795993354},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/sass-loader/dist/cjs.js","mtime":1586724165268},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/cache-loader/dist/cjs.js","mtime":1584795984278},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/vue-loader/lib/index.js","mtime":1584795993380}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmFudC1zZWxlY3QtZHJvcGRvd24tbWVudS1pdGVtIHsKICBvdmVyZmxvdzogdW5zZXQ7CiAgdGV4dC1vdmVyZmxvdzogdW5zZXQ7Cn0KCi5sb2NhdGlvbi1mb3JtLWdyb3VwIHsKICBpbnB1dC5jdXN0b20taW5wdXQsCiAgLmN1c3RvbS1pbnB1dCBpbnB1dCB7CiAgICB0ZXh0LWFsaWduOiBsZWZ0OwogIH0KfQo="},{"version":3,"sources":["LocationFormGroup.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgPA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"LocationFormGroup.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"location-form-group\">\n    <slot>\n      <!-- Straße / Hausnummer -->\n      <a-row>\n        <a-col :lg=\"12\" :sm=\"24\">\n          <a-form-item label=\"Straße, Hausnummer\" :itemSelfUpdate=\"true\">\n            <a-input-group compact>\n              <a-input\n                ref=\"street\"\n                class=\"custom-input\"\n                style=\"width: calc(100%);\"\n                placeholder=\"Straße und Hausnummer\"\n                v-decorator=\"[\n                  formFieldName('street'),\n                  {\n                    rules: [\n                      {\n                        required: $props.required !== false,\n                        message: 'Bitte Straße und Hausnummer eingeben',\n                      },\n                    ],\n                    initialValue: initialData('street'),\n                  },\n                ]\"\n              />\n            </a-input-group>\n          </a-form-item>\n        </a-col>\n        <a-col :lg=\"12\" :sm=\"24\">\n          <a-form-item label=\"PLZ, Ort\" :itemSelfUpdate=\"true\">\n            <a-input-group compact>\n              <a-auto-complete\n                ref=\"zip\"\n                class=\"custom-input\"\n                style=\"width: 50pt;\"\n                placeholder=\"PLZ\"\n                :dataSource=\"zips\"\n                optionLabelProp=\"value\"\n                @search=\"handleZipSearch\"\n                @select=\"(val) => handleZipSelection(val)\"\n                :dropdownMenuStyle=\"{\n                  width: 'max-content',\n                }\"\n                v-decorator=\"[\n                  formFieldName('zip'),\n                  {\n                    rules: [\n                      {\n                        required: $props.required !== false,\n                        message: 'Bitte PLZ eingeben',\n                      },\n                    ],\n                    initialValue: initialData('zip'),\n                  },\n                ]\"\n              />\n              <a-input\n                ref=\"city\"\n                class=\"custom-input\"\n                style=\"width: calc(100% - 60pt);\"\n                placeholder=\"Ort\"\n                v-decorator=\"[\n                  formFieldName('city'),\n                  {\n                    rules: [\n                      {\n                        required: $props.required !== false,\n                        message: 'Bitte Ort eingeben',\n                      },\n                    ],\n                    initialValue: initialData('city'),\n                  },\n                ]\"\n              />\n            </a-input-group>\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col :lg=\"12\" :sm=\"24\">\n          <a-form-item label=\"Land\" :itemSelfUpdate=\"true\">\n            <a-select\n              ref=\"country\"\n              class=\"custom-input\"\n              placeholder=\"Bitte wählen...\"\n              v-decorator=\"[\n                formFieldName('country'),\n                {\n                  rules: [\n                    {\n                      required: $props.required !== false,\n                      message: 'Bitte Land auswählen',\n                    },\n                  ],\n                  initialValue: initialCountry(),\n                },\n              ]\"\n            >\n              <a-select-option value=\"BE\">Belgien</a-select-option>\n              <a-select-option value=\"DK\">Dänemark</a-select-option>\n              <a-select-option value=\"DE\">Deutschland</a-select-option>\n              <a-select-option value=\"FR\">Frankreich</a-select-option>\n              <a-select-option value=\"GR\">Griechenland</a-select-option>\n              <a-select-option value=\"UK\">Großbritannien</a-select-option>\n              <a-select-option value=\"IT\">Italien</a-select-option>\n              <a-select-option value=\"LU\">Luxemburg</a-select-option>\n              <a-select-option value=\"NL\">Niederlande</a-select-option>\n              <a-select-option value=\"AT\">Österreich</a-select-option>\n              <a-select-option value=\"PL\">Polen</a-select-option>\n              <a-select-option value=\"PT\">Portugal</a-select-option>\n              <a-select-option value=\"RU\">Russland</a-select-option>\n              <a-select-option value=\"CH\">Schweiz</a-select-option>\n              <a-select-option value=\"ES\">Spanien</a-select-option>\n              <a-select-option value=\"CZ\">Tschechien</a-select-option>\n              <a-select-option value=\"TR\">Türkei</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </slot>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport Vue from 'vue'\nimport mixins from 'vue-typed-mixins'\nimport * as typing from '@/util/typing'\nimport { getPlzs, Plz } from '@/util/plz-service'\nimport { FormGroupMixin } from '@/util/forms'\n\ninterface Input extends Vue {\n  value: string\n  focus: () => void\n}\n\ninterface ZipEntry {\n  text: string\n  value: string\n  zipData: Plz\n}\n\nexport default mixins(FormGroupMixin).extend({\n  name: 'LocationFormGroup',\n  fieldIdentifiers: ['street', 'zip', 'city', 'country'],\n  props: ['required', 'data'],\n  data() {\n    return {\n      zips: [] as ZipEntry[],\n      currentZipSearch: '' as string,\n    }\n  },\n  methods: {\n    withExts() {\n      return typing.extended(this, typing.TypeArg<FormGroupMixin>())\n    },\n    initialCountry() {\n      const initialData = this.initialData('country')\n      if (!initialData && this.required) {\n        return 'Deutschland'\n      } else {\n        return initialData\n      }\n    },\n    initialData(fieldId: string) {\n      return this.$props.data\n        ? this.$props.data[this.withExts().formFieldName(fieldId)]\n        : null\n    },\n    updateByZipData(plzData: Plz) {\n      this.withExts().setData({\n        zip: plzData.fields.plz,\n        city: plzData.fields.note,\n        country: 'Deutschland',\n      })\n    },\n    async handleZipSearch(value: string) {\n      this.currentZipSearch = value\n      if (!value || value.length < 4) {\n        this.zips = []\n      } else {\n        const result: Plz[] = await getPlzs(value)\n        if (this.currentZipSearch !== value) {\n          // If a request takes longer, this request might be outdated since the user already changed the input\n          return\n        }\n        if (result.length === 0) {\n          return\n        }\n        if (result.length === 1) {\n          setTimeout(() => {\n            this.updateByZipData(result[0])\n            ;(this.$refs.city as Input).focus()\n          }, 0)\n          this.zips = []\n        } else {\n          this.zips = result.map((elem: Plz) => ({\n            text: `${elem.fields.plz} ${elem.fields.note}`,\n            value: elem.fields.plz,\n            zipData: elem,\n          })) as ZipEntry[]\n\n          const tweakDropdown = () => {\n            // Adjust width of PLZ dropdown\n            const ddRootId = document.evaluate(\n              'string(./descendant-or-self::*[@aria-controls and contains(@class, \"ant-select-selection\")]/@aria-controls)',\n              (this.$refs.zip as Vue).$el,\n              null,\n              XPathResult.STRING_TYPE\n            ).stringValue\n\n            let ddRoot = document.getElementById(ddRootId)\n            if (ddRoot) {\n              ddRoot = ddRoot.parentElement as HTMLElement\n              ddRoot.style.width = 'max-content'\n            } else {\n              Vue.nextTick(tweakDropdown)\n            }\n          }\n\n          Vue.nextTick(tweakDropdown)\n        }\n      }\n    },\n    handleZipSelection(value: string) {\n      const zipEntry = this.zips.find(\n        (entry: ZipEntry) => entry.value === value\n      ) as ZipEntry\n      if (zipEntry) {\n        setTimeout(() => {\n          this.updateByZipData(zipEntry.zipData)\n          ;(this.$refs.city as Input).focus()\n        }, 0)\n      }\n    },\n  },\n})\n</script>\n\n<style lang=\"scss\">\n.ant-select-dropdown-menu-item {\n  overflow: unset;\n  text-overflow: unset;\n}\n\n.location-form-group {\n  input.custom-input,\n  .custom-input input {\n    text-align: left;\n  }\n}\n</style>\n"]}]}