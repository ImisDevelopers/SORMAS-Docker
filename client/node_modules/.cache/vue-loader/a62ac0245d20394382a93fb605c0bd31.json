{"remainingRequest":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/src/components/LocationFormGroup.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/src/components/LocationFormGroup.vue","mtime":1589906836721},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/cache-loader/dist/cjs.js","mtime":1584795984278},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/thread-loader/dist/cjs.js","mtime":1584795984506},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/babel-loader/lib/index.js","mtime":1584795984276},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/ts-loader/index.js","mtime":1586724162024},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/cache-loader/dist/cjs.js","mtime":1584795984278},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/vue-loader/lib/index.js","mtime":1584795993380}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgVnVlIGZyb20gJ3Z1ZScKaW1wb3J0IG1peGlucyBmcm9tICd2dWUtdHlwZWQtbWl4aW5zJwppbXBvcnQgKiBhcyB0eXBpbmcgZnJvbSAnQC91dGlsL3R5cGluZycKaW1wb3J0IHsgZ2V0UGx6cywgUGx6IH0gZnJvbSAnQC91dGlsL3Bsei1zZXJ2aWNlJwppbXBvcnQgeyBGb3JtR3JvdXBNaXhpbiB9IGZyb20gJ0AvdXRpbC9mb3JtcycKCmludGVyZmFjZSBJbnB1dCBleHRlbmRzIFZ1ZSB7CiAgdmFsdWU6IHN0cmluZwogIGZvY3VzOiAoKSA9PiB2b2lkCn0KCmludGVyZmFjZSBaaXBFbnRyeSB7CiAgdGV4dDogc3RyaW5nCiAgdmFsdWU6IHN0cmluZwogIHppcERhdGE6IFBsegp9CgpleHBvcnQgZGVmYXVsdCBtaXhpbnMoRm9ybUdyb3VwTWl4aW4pLmV4dGVuZCh7CiAgbmFtZTogJ0xvY2F0aW9uRm9ybUdyb3VwJywKICBmaWVsZElkZW50aWZpZXJzOiBbJ3N0cmVldCcsICd6aXAnLCAnY2l0eScsICdjb3VudHJ5J10sCiAgcHJvcHM6IFsncmVxdWlyZWQnLCAnZGF0YSddLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB6aXBzOiBbXSBhcyBaaXBFbnRyeVtdLAogICAgICBjdXJyZW50WmlwU2VhcmNoOiAnJyBhcyBzdHJpbmcsCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICB3aXRoRXh0cygpIHsKICAgICAgcmV0dXJuIHR5cGluZy5leHRlbmRlZCh0aGlzLCB0eXBpbmcuVHlwZUFyZzxGb3JtR3JvdXBNaXhpbj4oKSkKICAgIH0sCiAgICBpbml0aWFsQ291bnRyeSgpIHsKICAgICAgY29uc3QgaW5pdGlhbERhdGEgPSB0aGlzLmluaXRpYWxEYXRhKCdjb3VudHJ5JykKICAgICAgaWYgKCFpbml0aWFsRGF0YSAmJiB0aGlzLnJlcXVpcmVkKSB7CiAgICAgICAgcmV0dXJuICdEZXV0c2NobGFuZCcKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gaW5pdGlhbERhdGEKICAgICAgfQogICAgfSwKICAgIGluaXRpYWxEYXRhKGZpZWxkSWQ6IHN0cmluZykgewogICAgICByZXR1cm4gdGhpcy4kcHJvcHMuZGF0YQogICAgICAgID8gdGhpcy4kcHJvcHMuZGF0YVt0aGlzLndpdGhFeHRzKCkuZm9ybUZpZWxkTmFtZShmaWVsZElkKV0KICAgICAgICA6IG51bGwKICAgIH0sCiAgICB1cGRhdGVCeVppcERhdGEocGx6RGF0YTogUGx6KSB7CiAgICAgIHRoaXMud2l0aEV4dHMoKS5zZXREYXRhKHsKICAgICAgICB6aXA6IHBsekRhdGEuZmllbGRzLnBseiwKICAgICAgICBjaXR5OiBwbHpEYXRhLmZpZWxkcy5ub3RlLAogICAgICAgIGNvdW50cnk6ICdEZXV0c2NobGFuZCcsCiAgICAgIH0pCiAgICB9LAogICAgYXN5bmMgaGFuZGxlWmlwU2VhcmNoKHZhbHVlOiBzdHJpbmcpIHsKICAgICAgdGhpcy5jdXJyZW50WmlwU2VhcmNoID0gdmFsdWUKICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS5sZW5ndGggPCA0KSB7CiAgICAgICAgdGhpcy56aXBzID0gW10KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCByZXN1bHQ6IFBseltdID0gYXdhaXQgZ2V0UGx6cyh2YWx1ZSkKICAgICAgICBpZiAodGhpcy5jdXJyZW50WmlwU2VhcmNoICE9PSB2YWx1ZSkgewogICAgICAgICAgLy8gSWYgYSByZXF1ZXN0IHRha2VzIGxvbmdlciwgdGhpcyByZXF1ZXN0IG1pZ2h0IGJlIG91dGRhdGVkIHNpbmNlIHRoZSB1c2VyIGFscmVhZHkgY2hhbmdlZCB0aGUgaW5wdXQKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy51cGRhdGVCeVppcERhdGEocmVzdWx0WzBdKQogICAgICAgICAgICA7KHRoaXMuJHJlZnMuY2l0eSBhcyBJbnB1dCkuZm9jdXMoKQogICAgICAgICAgfSwgMCkKICAgICAgICAgIHRoaXMuemlwcyA9IFtdCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuemlwcyA9IHJlc3VsdC5tYXAoKGVsZW06IFBseikgPT4gKHsKICAgICAgICAgICAgdGV4dDogYCR7ZWxlbS5maWVsZHMucGx6fSAke2VsZW0uZmllbGRzLm5vdGV9YCwKICAgICAgICAgICAgdmFsdWU6IGVsZW0uZmllbGRzLnBseiwKICAgICAgICAgICAgemlwRGF0YTogZWxlbSwKICAgICAgICAgIH0pKSBhcyBaaXBFbnRyeVtdCgogICAgICAgICAgY29uc3QgdHdlYWtEcm9wZG93biA9ICgpID0+IHsKICAgICAgICAgICAgLy8gQWRqdXN0IHdpZHRoIG9mIFBMWiBkcm9wZG93bgogICAgICAgICAgICBjb25zdCBkZFJvb3RJZCA9IGRvY3VtZW50LmV2YWx1YXRlKAogICAgICAgICAgICAgICdzdHJpbmcoLi9kZXNjZW5kYW50LW9yLXNlbGY6OipbQGFyaWEtY29udHJvbHMgYW5kIGNvbnRhaW5zKEBjbGFzcywgImFudC1zZWxlY3Qtc2VsZWN0aW9uIildL0BhcmlhLWNvbnRyb2xzKScsCiAgICAgICAgICAgICAgKHRoaXMuJHJlZnMuemlwIGFzIFZ1ZSkuJGVsLAogICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgWFBhdGhSZXN1bHQuU1RSSU5HX1RZUEUKICAgICAgICAgICAgKS5zdHJpbmdWYWx1ZQoKICAgICAgICAgICAgbGV0IGRkUm9vdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRkUm9vdElkKQogICAgICAgICAgICBpZiAoZGRSb290KSB7CiAgICAgICAgICAgICAgZGRSb290ID0gZGRSb290LnBhcmVudEVsZW1lbnQgYXMgSFRNTEVsZW1lbnQKICAgICAgICAgICAgICBkZFJvb3Quc3R5bGUud2lkdGggPSAnbWF4LWNvbnRlbnQnCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgVnVlLm5leHRUaWNrKHR3ZWFrRHJvcGRvd24pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBWdWUubmV4dFRpY2sodHdlYWtEcm9wZG93bikKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVaaXBTZWxlY3Rpb24odmFsdWU6IHN0cmluZykgewogICAgICBjb25zdCB6aXBFbnRyeSA9IHRoaXMuemlwcy5maW5kKAogICAgICAgIChlbnRyeTogWmlwRW50cnkpID0+IGVudHJ5LnZhbHVlID09PSB2YWx1ZQogICAgICApIGFzIFppcEVudHJ5CiAgICAgIGlmICh6aXBFbnRyeSkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy51cGRhdGVCeVppcERhdGEoemlwRW50cnkuemlwRGF0YSkKICAgICAgICAgIDsodGhpcy4kcmVmcy5jaXR5IGFzIElucHV0KS5mb2N1cygpCiAgICAgICAgfSwgMCkKICAgICAgfQogICAgfSwKICB9LAp9KQo="},{"version":3,"sources":["LocationFormGroup.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6HA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LocationFormGroup.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"location-form-group\">\n    <slot>\n      <!-- Straße / Hausnummer -->\n      <a-row>\n        <a-col :lg=\"12\" :sm=\"24\">\n          <a-form-item label=\"Straße, Hausnummer\" :itemSelfUpdate=\"true\">\n            <a-input-group compact>\n              <a-input\n                ref=\"street\"\n                class=\"custom-input\"\n                style=\"width: calc(100%);\"\n                placeholder=\"Straße und Hausnummer\"\n                v-decorator=\"[\n                  formFieldName('street'),\n                  {\n                    rules: [\n                      {\n                        required: $props.required !== false,\n                        message: 'Bitte Straße und Hausnummer eingeben',\n                      },\n                    ],\n                    initialValue: initialData('street'),\n                  },\n                ]\"\n              />\n            </a-input-group>\n          </a-form-item>\n        </a-col>\n        <a-col :lg=\"12\" :sm=\"24\">\n          <a-form-item label=\"PLZ, Ort\" :itemSelfUpdate=\"true\">\n            <a-input-group compact>\n              <a-auto-complete\n                ref=\"zip\"\n                class=\"custom-input\"\n                style=\"width: 50pt;\"\n                placeholder=\"PLZ\"\n                :dataSource=\"zips\"\n                optionLabelProp=\"value\"\n                @search=\"handleZipSearch\"\n                @select=\"(val) => handleZipSelection(val)\"\n                :dropdownMenuStyle=\"{\n                  width: 'max-content',\n                }\"\n                v-decorator=\"[\n                  formFieldName('zip'),\n                  {\n                    rules: [\n                      {\n                        required: $props.required !== false,\n                        message: 'Bitte PLZ eingeben',\n                      },\n                    ],\n                    initialValue: initialData('zip'),\n                  },\n                ]\"\n              />\n              <a-input\n                ref=\"city\"\n                class=\"custom-input\"\n                style=\"width: calc(100% - 60pt);\"\n                placeholder=\"Ort\"\n                v-decorator=\"[\n                  formFieldName('city'),\n                  {\n                    rules: [\n                      {\n                        required: $props.required !== false,\n                        message: 'Bitte Ort eingeben',\n                      },\n                    ],\n                    initialValue: initialData('city'),\n                  },\n                ]\"\n              />\n            </a-input-group>\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col :lg=\"12\" :sm=\"24\">\n          <a-form-item label=\"Land\" :itemSelfUpdate=\"true\">\n            <a-select\n              ref=\"country\"\n              class=\"custom-input\"\n              placeholder=\"Bitte wählen...\"\n              v-decorator=\"[\n                formFieldName('country'),\n                {\n                  rules: [\n                    {\n                      required: $props.required !== false,\n                      message: 'Bitte Land auswählen',\n                    },\n                  ],\n                  initialValue: initialCountry(),\n                },\n              ]\"\n            >\n              <a-select-option value=\"BE\">Belgien</a-select-option>\n              <a-select-option value=\"DK\">Dänemark</a-select-option>\n              <a-select-option value=\"DE\">Deutschland</a-select-option>\n              <a-select-option value=\"FR\">Frankreich</a-select-option>\n              <a-select-option value=\"GR\">Griechenland</a-select-option>\n              <a-select-option value=\"UK\">Großbritannien</a-select-option>\n              <a-select-option value=\"IT\">Italien</a-select-option>\n              <a-select-option value=\"LU\">Luxemburg</a-select-option>\n              <a-select-option value=\"NL\">Niederlande</a-select-option>\n              <a-select-option value=\"AT\">Österreich</a-select-option>\n              <a-select-option value=\"PL\">Polen</a-select-option>\n              <a-select-option value=\"PT\">Portugal</a-select-option>\n              <a-select-option value=\"RU\">Russland</a-select-option>\n              <a-select-option value=\"CH\">Schweiz</a-select-option>\n              <a-select-option value=\"ES\">Spanien</a-select-option>\n              <a-select-option value=\"CZ\">Tschechien</a-select-option>\n              <a-select-option value=\"TR\">Türkei</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </slot>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport Vue from 'vue'\nimport mixins from 'vue-typed-mixins'\nimport * as typing from '@/util/typing'\nimport { getPlzs, Plz } from '@/util/plz-service'\nimport { FormGroupMixin } from '@/util/forms'\n\ninterface Input extends Vue {\n  value: string\n  focus: () => void\n}\n\ninterface ZipEntry {\n  text: string\n  value: string\n  zipData: Plz\n}\n\nexport default mixins(FormGroupMixin).extend({\n  name: 'LocationFormGroup',\n  fieldIdentifiers: ['street', 'zip', 'city', 'country'],\n  props: ['required', 'data'],\n  data() {\n    return {\n      zips: [] as ZipEntry[],\n      currentZipSearch: '' as string,\n    }\n  },\n  methods: {\n    withExts() {\n      return typing.extended(this, typing.TypeArg<FormGroupMixin>())\n    },\n    initialCountry() {\n      const initialData = this.initialData('country')\n      if (!initialData && this.required) {\n        return 'Deutschland'\n      } else {\n        return initialData\n      }\n    },\n    initialData(fieldId: string) {\n      return this.$props.data\n        ? this.$props.data[this.withExts().formFieldName(fieldId)]\n        : null\n    },\n    updateByZipData(plzData: Plz) {\n      this.withExts().setData({\n        zip: plzData.fields.plz,\n        city: plzData.fields.note,\n        country: 'Deutschland',\n      })\n    },\n    async handleZipSearch(value: string) {\n      this.currentZipSearch = value\n      if (!value || value.length < 4) {\n        this.zips = []\n      } else {\n        const result: Plz[] = await getPlzs(value)\n        if (this.currentZipSearch !== value) {\n          // If a request takes longer, this request might be outdated since the user already changed the input\n          return\n        }\n        if (result.length === 0) {\n          return\n        }\n        if (result.length === 1) {\n          setTimeout(() => {\n            this.updateByZipData(result[0])\n            ;(this.$refs.city as Input).focus()\n          }, 0)\n          this.zips = []\n        } else {\n          this.zips = result.map((elem: Plz) => ({\n            text: `${elem.fields.plz} ${elem.fields.note}`,\n            value: elem.fields.plz,\n            zipData: elem,\n          })) as ZipEntry[]\n\n          const tweakDropdown = () => {\n            // Adjust width of PLZ dropdown\n            const ddRootId = document.evaluate(\n              'string(./descendant-or-self::*[@aria-controls and contains(@class, \"ant-select-selection\")]/@aria-controls)',\n              (this.$refs.zip as Vue).$el,\n              null,\n              XPathResult.STRING_TYPE\n            ).stringValue\n\n            let ddRoot = document.getElementById(ddRootId)\n            if (ddRoot) {\n              ddRoot = ddRoot.parentElement as HTMLElement\n              ddRoot.style.width = 'max-content'\n            } else {\n              Vue.nextTick(tweakDropdown)\n            }\n          }\n\n          Vue.nextTick(tweakDropdown)\n        }\n      }\n    },\n    handleZipSelection(value: string) {\n      const zipEntry = this.zips.find(\n        (entry: ZipEntry) => entry.value === value\n      ) as ZipEntry\n      if (zipEntry) {\n        setTimeout(() => {\n          this.updateByZipData(zipEntry.zipData)\n          ;(this.$refs.city as Input).focus()\n        }, 0)\n      }\n    },\n  },\n})\n</script>\n\n<style lang=\"scss\">\n.ant-select-dropdown-menu-item {\n  overflow: unset;\n  text-overflow: unset;\n}\n\n.location-form-group {\n  input.custom-input,\n  .custom-input input {\n    text-align: left;\n  }\n}\n</style>\n"]}]}