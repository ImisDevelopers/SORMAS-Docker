{"remainingRequest":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/src/views/SubmitTestResult.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/src/views/SubmitTestResult.vue","mtime":1589906836724},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/cache-loader/dist/cjs.js","mtime":1584795984278},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/thread-loader/dist/cjs.js","mtime":1584795984506},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/babel-loader/lib/index.js","mtime":1584795984276},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/ts-loader/index.js","mtime":1586724162024},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/cache-loader/dist/cjs.js","mtime":1584795984278},{"path":"/home/cirotzki/projects/virus/1_011_a_infektionsfall_uebermittellung/client/node_modules/vue-loader/lib/index.js","mtime":1584795993380}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgeyBJbnN0aXR1dGlvbiwgTGFiVGVzdCB9IGZyb20gJ0AvYXBpL1N3YWdnZXJBcGknCmltcG9ydCBWdWUgZnJvbSAndnVlJwppbXBvcnQgQXBpIGZyb20gJ0AvYXBpJwppbXBvcnQgVGVzdElucHV0IGZyb20gJ0AvY29tcG9uZW50cy9UZXN0SW5wdXQudnVlJwppbXBvcnQgTGFib3JhdG9yeUlucHV0IGZyb20gJ0AvY29tcG9uZW50cy9MYWJvcmF0b3J5SW5wdXQudnVlJwppbXBvcnQgRGF0ZUlucHV0IGZyb20gJ0AvY29tcG9uZW50cy9EYXRlSW5wdXQudnVlJwppbXBvcnQgeyBhdXRoTWFwcGVyIH0gZnJvbSAnQC9zdG9yZS9tb2R1bGVzL2F1dGgubW9kdWxlJwppbXBvcnQgeyB0ZXN0UmVzdWx0cywgVGVzdFJlc3VsdFR5cGUgfSBmcm9tICdAL21vZGVscy9ldmVudC10eXBlcycKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnCgppbnRlcmZhY2UgU3RhdGUgewogIGZvcm06IGFueQogIGZpbGVCeXRlcz86IGFueQogIHRlc3RSZXN1bHRzOiBUZXN0UmVzdWx0VHlwZVtdCiAgbGFib3JhdG9yaWVzOiBJbnN0aXR1dGlvbltdCiAgdXBkYXRlZExhYlRlc3Q/OiBMYWJUZXN0CiAgdXBkYXRlZExhYlRlc3RTdGF0dXM6IHN0cmluZwogIHRvZGF5OiBtb21lbnQuTW9tZW50Cn0KCmV4cG9ydCBkZWZhdWx0IFZ1ZS5leHRlbmQoewogIG5hbWU6ICdTdWJtaXRUZXN0UmVzdWx0JywKICBjb21wdXRlZDogewogICAgLi4uYXV0aE1hcHBlci5tYXBHZXR0ZXJzKHsgaW5zdGl0dXRpb246ICdpbnN0aXR1dGlvbicgfSksCiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBUZXN0SW5wdXQsCiAgICBMYWJvcmF0b3J5SW5wdXQsCiAgICBEYXRlSW5wdXQsCiAgfSwKICBwcm9wczoge30sCiAgZGF0YSgpOiBTdGF0ZSB7CiAgICByZXR1cm4gewogICAgICBmb3JtOiB0aGlzLiRmb3JtLmNyZWF0ZUZvcm0odGhpcyksCiAgICAgIGZpbGVCeXRlczogdW5kZWZpbmVkLAogICAgICAvLyBUT0RPOiBBZnRlciBzaW11bGF0aW9uLCByZW1vdmUgdGhlIGZpbHRlcgogICAgICB0ZXN0UmVzdWx0czogdGVzdFJlc3VsdHMuZmlsdGVyKAogICAgICAgICh0ZXN0UmVzdWx0KSA9PgogICAgICAgICAgdGVzdFJlc3VsdC5pZCA9PT0gJ1RFU1RfUE9TSVRJVkUnIHx8IHRlc3RSZXN1bHQuaWQgPT09ICdURVNUX05FR0FUSVZFJwogICAgICApLAogICAgICBsYWJvcmF0b3JpZXM6IFtdLAogICAgICB1cGRhdGVkTGFiVGVzdDogdW5kZWZpbmVkLAogICAgICB1cGRhdGVkTGFiVGVzdFN0YXR1czogJycsCiAgICAgIHRvZGF5OiBtb21lbnQoKSwKICAgIH0KICB9LAogIGFzeW5jIG1vdW50ZWQoKSB7CiAgICBpZiAoIXRoaXMuaW5zdGl0dXRpb24oKSkgewogICAgICBjb25zb2xlLmxvZygnTG9hZGluZyBpbnN0aXR1dGlvbicpCiAgICAgIGF3YWl0IHRoaXMuZ2V0QXV0aGVudGljYXRlZEluc3RpdHV0aW9uKCkKICAgIH0KICAgIGNvbnN0IGxhYiA9IHRoaXMuaW5zdGl0dXRpb24oKQogICAgaWYgKGxhYiAmJiBsYWIudHlwZSA9PT0gJ0xBQk9SQVRPUlknKSB7CiAgICAgIHRoaXMubGFib3JhdG9yaWVzID0gW2xhYl0KICAgICAgdGhpcy5mb3JtLnNldEZpZWxkc1ZhbHVlKHsKICAgICAgICBsYWJvcmF0b3J5SWQ6IGxhYi5pZCwKICAgICAgfSkKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZm9ybS5zZXRGaWVsZHNWYWx1ZSh7CiAgICAgICAgbGFib3JhdG9yeUlkOiAnJywKICAgICAgfSkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC4uLmF1dGhNYXBwZXIubWFwQWN0aW9ucyh7CiAgICAgIGdldEF1dGhlbnRpY2F0ZWRJbnN0aXR1dGlvbjogJ2dldEF1dGhlbnRpY2F0ZWRJbnN0aXR1dGlvbicsCiAgICB9KSwKICAgIHVwbG9hZEhpbnQoKSB7CiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IHsKICAgICAgICBtZXNzYWdlOgogICAgICAgICAgJ0RhcyBMYWJvciBrYW5uIGhpZXIgZGVuIEJlcmljaHQgbWl0IGhvY2hsYWRlbi4gQXVzIFNpY2hlcmhlaXRzZ3LDvG5kZW4gaXN0IGRpZXNlIEZ1bmt0aW9uIGltIFByb3RvdHlwIGRlYWt0aXZpZXJ0LicsCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICB9CiAgICAgIHRoaXMuJG5vdGlmaWNhdGlvbi5pbmZvKG5vdGlmaWNhdGlvbikKICAgIH0sCiAgICBiZWZvcmVVcGxvYWQoZmlsZTogRmlsZSkgewogICAgICBjb25zdCBzZXRGaWxlQnl0ZXMgPSAoZmlsZUJ5dGVzOiBhbnkpID0+IHsKICAgICAgICB0aGlzLmZpbGVCeXRlcyA9IGZpbGVCeXRlcwogICAgICB9CgogICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpCiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZTogYW55KSA9PiB7CiAgICAgICAgY29uc3QgdXRmOCA9IHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChlLnRhcmdldC5yZXN1bHQpKQogICAgICAgIGNvbnN0IGFycmF5ID0gW10KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV0ZjgubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGFycmF5LnB1c2godXRmOC5jaGFyQ29kZUF0KGkpKQogICAgICAgIH0KICAgICAgICBzZXRGaWxlQnl0ZXMoYXJyYXkpCiAgICAgIH0KICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSkKCiAgICAgIHJldHVybiBmYWxzZQogICAgfSwKICAgIGhhbmRsZVN1Ym1pdCgpIHsKICAgICAgdGhpcy5mb3JtLnZhbGlkYXRlRmllbGRzKChlcnI6IEVycm9yLCB2YWx1ZXM6IGFueSkgPT4gewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KCiAgICAgICAgY29uc3QgeyB0ZXN0SWQgfSA9IHZhbHVlcwogICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7CiAgICAgICAgICB0ZXN0SWQsCiAgICAgICAgICBzdGF0dXM6IHZhbHVlcy50ZXN0UmVzdWx0LAogICAgICAgICAgY29tbWVudDogdmFsdWVzLmNvbW1lbnQsCiAgICAgICAgICBmaWxlOiB0aGlzLmZpbGVCeXRlcywKICAgICAgICAgIGV2ZW50RGF0ZTogdmFsdWVzLmV2ZW50RGF0ZSwKICAgICAgICB9CgogICAgICAgIEFwaS51cGRhdGVUZXN0U3RhdHVzVXNpbmdQdXQodmFsdWVzLmxhYm9yYXRvcnlJZCwgcmVxdWVzdCkKICAgICAgICAgIC50aGVuKChsYWJUZXN0KSA9PiB7CiAgICAgICAgICAgIHRoaXMuZm9ybS5yZXNldEZpZWxkcyhbJ3Rlc3RJZCcsICd0ZXN0UmVzdWx0JywgJ2NvbW1lbnQnXSkKICAgICAgICAgICAgdGhpcy5maWxlQnl0ZXMgPSBudWxsCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRMYWJUZXN0ID0gbGFiVGVzdAogICAgICAgICAgICBjb25zdCB1cGRhdGVkTGFiVGVzdFN0YXR1cyA9CiAgICAgICAgICAgICAgdGVzdFJlc3VsdHMuZmluZCgKICAgICAgICAgICAgICAgICh0ZXN0UmVzdWx0KSA9PiB0ZXN0UmVzdWx0LmlkID09PSBsYWJUZXN0LnRlc3RTdGF0dXMKICAgICAgICAgICAgICApPy5sYWJlbCB8fCAnJwogICAgICAgICAgICBjb25zdCBoID0gdGhpcy4kY3JlYXRlRWxlbWVudAogICAgICAgICAgICB0aGlzLiRzdWNjZXNzKHsKICAgICAgICAgICAgICB0aXRsZTogJ0RlciBUZXN0IHd1cmRlIGVyZm9sZ3JlaWNoIGFrdHVhbGlzaWVydC4nLAogICAgICAgICAgICAgIGNvbnRlbnQ6IGgoJ2RpdicsIHt9LCBbCiAgICAgICAgICAgICAgICBoKCdkaXYnLCBgVGVzdCBJRDogJHt1cGRhdGVkTGFiVGVzdC50ZXN0SWR9YCksCiAgICAgICAgICAgICAgICBoKCdkaXYnLCBgTmV1ZXIgVGVzdCBTdGF0dXM6ICR7dXBkYXRlZExhYlRlc3RTdGF0dXN9YCksCiAgICAgICAgICAgICAgXSksCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gewogICAgICAgICAgICAgIG1lc3NhZ2U6ICdGZWhsZXIgYmVpbSBIaW56dWbDvGdlbiBkZXMgVGVzdGVyZ2Vibmlzc2VzLicsCiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGVyci5tZXNzYWdlLAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJG5vdGlmaWNhdGlvbi5lcnJvcihub3RpZmljYXRpb24pCiAgICAgICAgICB9KQogICAgICB9KQogICAgfSwKICB9LAp9KQo="},{"version":3,"sources":["SubmitTestResult.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SubmitTestResult.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <a-card style=\"max-width: 500px; margin: 2rem auto; min-height: 300px;\">\n    <div>\n      <a-form\n        :form=\"form\"\n        :label-col=\"{ span: 6 }\"\n        :wrapper-col=\"{ span: 18 }\"\n        @submit.prevent=\"handleSubmit\"\n      >\n        <!-- Labor -->\n        <LaboratoryInput\n          :form=\"form\"\n          :initial-labs=\"laboratories\"\n          :validation=\"[\n            'laboratoryId',\n            {\n              rules: [\n                {\n                  required: true,\n                  message: 'Bitte wÃ¤hlen Sie ein Labor aus.',\n                },\n              ],\n            },\n          ]\"\n          label=\"Labor\"\n        />\n\n        <!-- TestId -->\n        <TestInput\n          :form=\"form\"\n          :validation=\"[\n            'testId',\n            {\n              rules: [\n                {\n                  required: true,\n                  message: 'Bitte geben Sie Ihre Test-ID ein.',\n                },\n              ],\n            },\n          ]\"\n          label=\"Test-ID\"\n          placeholder=\"z.B 1337-4237-9438\"\n        />\n\n        <!-- TestResult -->\n        <a-form-item label=\"Testresultat\">\n          <a-radio-group\n            class=\"imis-radio-group\"\n            v-decorator=\"[\n              'testResult',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'Bitte geben Sie das Testresultat an.',\n                  },\n                ],\n              },\n            ]\"\n          >\n            <a-radio\n              :key=\"testResult.id\"\n              :value=\"testResult.id\"\n              v-for=\"testResult in testResults\"\n            >\n              <a-icon :type=\"testResult.icon\" />\n              {{ testResult.label }}\n            </a-radio>\n          </a-radio-group>\n        </a-form-item>\n\n        <a-form-item label=\"Ergebnisdatum\">\n          <DateInput\n            :defaultValue=\"today\"\n            v-decorator=\"[\n              'eventDate',\n              {\n                rules: [\n                  {\n                    required: false,\n                    message: 'Datum der Probenabnahme',\n                  },\n                ],\n              },\n            ]\"\n          />\n        </a-form-item>\n\n        <!-- Kommentar -->\n        <a-form-item label=\"Kommentar\">\n          <a-textarea\n            :autoSize=\"{ minRows: 3, maxRows: 5 }\"\n            placeholder=\"Kommentar hinzufÃ¼gen\"\n            v-decorator=\"['comment']\"\n          />\n        </a-form-item>\n\n        <!-- Hochladen -->\n        <a-form-item :wrapper-col=\"{ span: 24 }\">\n          <a-button v-on:click=\"uploadHint()\">\n            <a-icon type=\"upload\" />\n            Test Report hochladen\n          </a-button>\n        </a-form-item>\n        <a-divider />\n\n        <!-- Speichern -->\n        <a-form-item :wrapper-col=\"{ span: 24, offset: 0 }\">\n          <a-button html-type=\"submit\" type=\"primary\">\n            Speichern\n          </a-button>\n        </a-form-item>\n      </a-form>\n    </div>\n  </a-card>\n</template>\n\n<script lang=\"ts\">\nimport { Institution, LabTest } from '@/api/SwaggerApi'\nimport Vue from 'vue'\nimport Api from '@/api'\nimport TestInput from '@/components/TestInput.vue'\nimport LaboratoryInput from '@/components/LaboratoryInput.vue'\nimport DateInput from '@/components/DateInput.vue'\nimport { authMapper } from '@/store/modules/auth.module'\nimport { testResults, TestResultType } from '@/models/event-types'\nimport moment from 'moment'\n\ninterface State {\n  form: any\n  fileBytes?: any\n  testResults: TestResultType[]\n  laboratories: Institution[]\n  updatedLabTest?: LabTest\n  updatedLabTestStatus: string\n  today: moment.Moment\n}\n\nexport default Vue.extend({\n  name: 'SubmitTestResult',\n  computed: {\n    ...authMapper.mapGetters({ institution: 'institution' }),\n  },\n  components: {\n    TestInput,\n    LaboratoryInput,\n    DateInput,\n  },\n  props: {},\n  data(): State {\n    return {\n      form: this.$form.createForm(this),\n      fileBytes: undefined,\n      // TODO: After simulation, remove the filter\n      testResults: testResults.filter(\n        (testResult) =>\n          testResult.id === 'TEST_POSITIVE' || testResult.id === 'TEST_NEGATIVE'\n      ),\n      laboratories: [],\n      updatedLabTest: undefined,\n      updatedLabTestStatus: '',\n      today: moment(),\n    }\n  },\n  async mounted() {\n    if (!this.institution()) {\n      console.log('Loading institution')\n      await this.getAuthenticatedInstitution()\n    }\n    const lab = this.institution()\n    if (lab && lab.type === 'LABORATORY') {\n      this.laboratories = [lab]\n      this.form.setFieldsValue({\n        laboratoryId: lab.id,\n      })\n    } else {\n      this.form.setFieldsValue({\n        laboratoryId: '',\n      })\n    }\n  },\n  methods: {\n    ...authMapper.mapActions({\n      getAuthenticatedInstitution: 'getAuthenticatedInstitution',\n    }),\n    uploadHint() {\n      const notification = {\n        message:\n          'Das Labor kann hier den Bericht mit hochladen. Aus SicherheitsgrÃ¼nden ist diese Funktion im Prototyp deaktiviert.',\n        description: '',\n      }\n      this.$notification.info(notification)\n    },\n    beforeUpload(file: File) {\n      const setFileBytes = (fileBytes: any) => {\n        this.fileBytes = fileBytes\n      }\n\n      const reader = new FileReader()\n      reader.onload = (e: any) => {\n        const utf8 = unescape(encodeURIComponent(e.target.result))\n        const array = []\n        for (let i = 0; i < utf8.length; i++) {\n          array.push(utf8.charCodeAt(i))\n        }\n        setFileBytes(array)\n      }\n      reader.readAsDataURL(file)\n\n      return false\n    },\n    handleSubmit() {\n      this.form.validateFields((err: Error, values: any) => {\n        if (err) {\n          return\n        }\n\n        const { testId } = values\n        const request = {\n          testId,\n          status: values.testResult,\n          comment: values.comment,\n          file: this.fileBytes,\n          eventDate: values.eventDate,\n        }\n\n        Api.updateTestStatusUsingPut(values.laboratoryId, request)\n          .then((labTest) => {\n            this.form.resetFields(['testId', 'testResult', 'comment'])\n            this.fileBytes = null\n            const updatedLabTest = labTest\n            const updatedLabTestStatus =\n              testResults.find(\n                (testResult) => testResult.id === labTest.testStatus\n              )?.label || ''\n            const h = this.$createElement\n            this.$success({\n              title: 'Der Test wurde erfolgreich aktualisiert.',\n              content: h('div', {}, [\n                h('div', `Test ID: ${updatedLabTest.testId}`),\n                h('div', `Neuer Test Status: ${updatedLabTestStatus}`),\n              ]),\n            })\n          })\n          .catch((err) => {\n            const notification = {\n              message: 'Fehler beim HinzufÃ¼gen des Testergebnisses.',\n              description: err.message,\n            }\n            this.$notification.error(notification)\n          })\n      })\n    },\n  },\n})\n</script>\n\n<style scoped lang=\"scss\"></style>\n"]}]}